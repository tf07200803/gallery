<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<script src='http://www.google.com/jsapi' type='text/javascript'></script>
<script src="src/jquery-1.11.0.min.js"></script>
<script src="client.js" type="text/javascript"></script>
<form id="form" method="post" action="http://demo.artstudio.com.tw/15/20160116/server.php" enctype="multipart/form-data">
    <input type="hidden" name="max_file_size" value="1048576">
    <input type="text" class="textClass2" id="photoUrl" disabled="disabled" />
    <input type="file" name="file" id="imageInput" onchange="loadImageFile();" /> * Max File Size: 1MB
    <br />
    
    <input type="hidden" name="picurl" id="picurl">
    <br />    
    <button type="submit">UPLOAD</button>
</form>
<div id="output"></div>
圖片：   
<br>  
<div id="imagePreview"></div> 

<script type="text/javascript"> 
var loadImageFile = (function () { 
if (window.FileReader) { 
var oPreviewImg = null, oFReader = new window.FileReader(), 
rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i; 

oFReader.onload = function (oFREvent) { 
if (!oPreviewImg) { 
var newPreview = document.getElementById("imagePreview"); 
oPreviewImg = new Image(); 

newPreview.appendChild(oPreviewImg); 
} 
oPreviewImg.src = oFREvent.target.result; 
}; 

return function () { 
var aFiles = document.getElementById("imageInput").files; 
console.log(aFiles)
$("#photoUrl").val(aFiles[0].name)
var date=new Date()
var filename = aFiles[0].name;
 
var extIndex = filename.lastIndexOf('.');
var ext

if (extIndex != -1) 
{
   var name = filename.substr(0, extIndex);                     //檔名不含副檔名
 
   ext= filename.substr(extIndex+1, filename.length);  //副檔名
}


//console.log(date.getYear()+"_"+date.getDay()+"_"+date.getHours()+"_"+date.getMinutes()+"_"+date.getSeconds()+"_"+date.getMilliseconds()+"_"+aFiles[0].name)
$("#picurl").val(date.getYear()+"_"+date.getDay()+"_"+date.getHours()+"_"+date.getMinutes()+"_"+date.getSeconds()+"_"+date.getMilliseconds()+"_"+Math.floor(Math.random()*10000000)+"."+ext)
if (aFiles.length === 0) { return; } 
if (!rFilter.test(aFiles[0].type)) { alert("You must select a valid image file!"); return; } 
oFReader.readAsDataURL(aFiles[0]); 
} 

} 
if (navigator.appName === "Microsoft Internet Explorer") { 
return function () { 
alert(document.getElementById("imageInput").value); 
document.getElementById("imagePreview").filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = document.getElementById("imageInput").value; 

} 
} 
})(); 
</script>
<img src="" id="uploadImg" alt=""  />
</html>
