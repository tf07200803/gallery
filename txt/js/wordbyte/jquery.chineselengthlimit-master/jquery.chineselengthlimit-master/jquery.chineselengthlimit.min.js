(function(a){a.fn.ChineseLengthLimit=function(j){var e={limitCount:10,isByte:true,callback:undefined},b=a.extend({},e,j),g=a(this),k=0,f=0,i=b.limitCount,h=0,d,c;d=function(){var l={input:(b.isByte)?k:f,max:i,left:h};return l};c=function(){var l=0;if(b.isByte){l=g.val().replace(/[^\x00-\xff]/g,"pp").length+(g.val().match(/\n/g)||[]).length}else{l=g.val().length+(g.val().match(/\n/g)||[]).length}if(l>b.limitCount){if(b.isByte){g.val(g.val().slice(0,f+Math.floor((b.limitCount-k)/2)));k=g.val().replace(/[^\x00-\xff]/g,"pp").length}else{g.val(g.val().slice(0,j.limitCount))}}f=g.val().length+(g.val().match(/\n/g)||[]).length;k=g.val().replace(/[^\x00-\xff]/g,"pp").length+(g.val().match(/\n/g)||[]).length;if(b.isByte){h=i-k}else{h=i-f}if(typeof(b.callback)==="function"){b.callback.call(this,d())}};g.on("checkLimit",function(){setTimeout(function(){c()},15)});return this.each(function(){var l=a(this);if((!j||!j.limitCount)&&parseInt(l.attr("maxlength"),10)>0&&parseInt(l.attr("maxlength"),10)!==b.limitCount){l.ChineseLengthLimit(a.extend({},b,{limitCount:parseInt(l.attr("maxlength"),10)}),b.callback)}else{g.attr("maxlength",b.limitCount);g.on("keyup paste",function(){setTimeout(function(){c()},15)})}})}}(jQuery));